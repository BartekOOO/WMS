<div th:fragment="fragment" xmlns:th="http://www.thymeleaf.org">

    <section class="card">
        <header class="card-h">
            <div style="display:flex;flex-direction:column;gap:4px;min-width:0">
                <h2>Nowy magazyn</h2>
                <div style="color:rgba(255,255,255,0.65);font-size:.92rem">Tryb: dodawanie</div>
            </div>

            <div class="card-actions">
                <a class="chip" th:href="@{/Warehouses/GetWarehouses}">Wr√≥ƒá</a>
            </div>
        </header>

        <div class="card-b">

            <div class="alert-glass alert-glass--success" th:if="${success != null}">
                <div class="alert-glass__icon">‚úì</div>
                <div class="alert-glass__content">
                    <div class="alert-glass__title">Sukces</div>
                    <div class="alert-glass__msg" th:text="${success}">Operacja zako≈Ñczona powodzeniem.</div>
                </div>
            </div>


            <div class="alert-glass alert-glass--danger" th:if="${error != null}">
                <div class="alert-glass__icon">!</div>
                <div class="alert-glass__content">
                    <div class="alert-glass__title">Nie uda≈Ço siƒô wykonaƒá operacji</div>
                    <div class="alert-glass__msg" th:text="${error}">WystƒÖpi≈Ç b≈ÇƒÖd podczas zapisu.</div>
                </div>
            </div>

            <form th:object="${command}"
                  th:action="@{/Warehouses/RegisterWarehouse}"
                  method="post"
                  style="display:grid;gap:14px">

                <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
                    <div>
                        <label class="form-label">Kod</label>
                        <input class="form-input mono"
                               th:field="*{warehouse.code}"
                               placeholder="np. MAG-01"
                               required/>
                        <div class="form-err" th:if="${#fields.hasErrors('warehouse.code')}" th:errors="*{warehouse.code}"></div>
                    </div>

                    <div>
                        <label class="form-label">Nazwa</label>
                        <input class="form-input"
                               th:field="*{warehouse.name}"
                               placeholder="np. Magazyn centralny"
                               required/>
                        <div class="form-err" th:if="${#fields.hasErrors('warehouse.name')}" th:errors="*{warehouse.name}"></div>
                    </div>

                    <div style="grid-column:1 / -1">
                        <label class="form-label">Opis (opcjonalnie)</label>
                        <textarea class="form-input"
                                  th:field="*{warehouse.description}"
                                  style="min-height:120px;resize:vertical"
                                  placeholder="Kr√≥tki opis magazynu..."></textarea>
                        <div class="form-err" th:if="${#fields.hasErrors('warehouse.description')}" th:errors="*{warehouse.description}"></div>
                    </div>
                </div>

                <div style="height:18px"></div>

                <section class="card"
                         style="box-shadow:none;border:1px solid rgba(255,255,255,0.10);background:rgba(255,255,255,0.03)">
                    <header class="card-h" style="border-bottom:1px solid rgba(255,255,255,0.08)">
                        <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;width:100%">
                            <h2 style="font-size:1.05rem">Adres magazynu</h2>

                            <label class="switch" style="margin-left:auto">
                                <input type="checkbox"
                                       id="useExistingAddress"
                                       th:checked="${command.addressId != null}"
                                       onchange="toggleWarehouseAddressMode()"/>
                                <span class="switch-tx">U≈ºyj istniejƒÖcego adresu firmy</span>
                            </label>
                        </div>
                    </header>

                    <div class="card-b" style="display:grid;gap:12px">

                        <div class="form-hint" style="margin-top:-4px">
                            Wybierz: adres z listy (firmowy) albo wpisz nowy. Jedno z dw√≥ch jest obowiƒÖzkowe.
                        </div>

                        <div id="addrPick"
                             th:style="${command.addressId != null ? '' : 'display:none'}">
                            <label class="form-label">Adres firmy</label>

                            <select class="form-input"
                                    id="addressIdSelect"
                                    th:field="*{addressId}">
                                <option value="">‚Äî wybierz adres ‚Äî</option>
                                <option th:each="a : ${companyAddresses}"
                                        th:value="${a.id}"
                                        th:text="${a.street + ', ' + a.zipCode + ' ' + a.city + ', ' + a.country}">
                                </option>
                            </select>

                            <div class="form-err" th:if="${#fields.hasErrors('addressId')}" th:errors="*{addressId}"></div>

                            <div class="form-hint"
                                 th:text="${companyCustomer != null ? '≈πr√≥d≈Ço: ' + companyCustomer.acronym + ' ‚Ä¢ ' + companyCustomer.fullName : 'Brak skonfigurowanego kontrahenta firmowego / brak adres√≥w.'}">
                                ‚Äî
                            </div>
                        </div>

                        <div id="addrNew"
                             th:style="${command.addressId != null ? 'display:none' : ''}">

                            <div style="display:grid;grid-template-columns:2fr 1fr;gap:12px">
                                <div>
                                    <label class="form-label">Ulica</label>
                                    <input class="form-input"
                                           id="addrStreet"
                                           th:field="*{address.street}"
                                           placeholder="Ulica, nr..."
                                           required/>
                                    <div class="form-err" th:if="${#fields.hasErrors('address.street')}" th:errors="*{address.street}"></div>
                                </div>

                                <div>
                                    <label class="form-label">Kod</label>
                                    <input class="form-input"
                                           id="addrZip"
                                           th:field="*{address.zipCode}"
                                           placeholder="00-000"
                                           required/>
                                    <div class="form-err" th:if="${#fields.hasErrors('address.zipCode')}" th:errors="*{address.zipCode}"></div>
                                </div>

                                <div>
                                    <label class="form-label">Miasto</label>
                                    <input class="form-input"
                                           id="addrCity"
                                           th:field="*{address.city}"
                                           placeholder="Miasto"
                                           required/>
                                    <div class="form-err" th:if="${#fields.hasErrors('address.city')}" th:errors="*{address.city}"></div>
                                </div>

                                <div>
                                    <label class="form-label">Wojew√≥dztwo</label>
                                    <input class="form-input"
                                           id="addrState"
                                           th:field="*{address.state}"
                                           placeholder="np. Mazowieckie"/>
                                    <div class="form-err" th:if="${#fields.hasErrors('address.state')}" th:errors="*{address.state}"></div>
                                </div>

                                <div style="grid-column:1 / -1">
                                    <label class="form-label">Kraj</label>
                                    <input class="form-input"
                                           id="addrCountry"
                                           th:field="*{address.country}"
                                           placeholder="PL"
                                           required/>
                                    <div class="form-err" th:if="${#fields.hasErrors('address.country')}" th:errors="*{address.country}"></div>
                                </div>
                            </div>

                        </div>
                    </div>
                </section>

                <div style="height:18px"></div>

                <section class="card sector-card sector-card--loading"
                         style="box-shadow:none;border:1px solid rgba(255,255,255,0.10)">
                    <header class="card-h" style="border-bottom:1px solid rgba(255,255,255,0.08)">
                        <div style="display:flex;flex-direction:column;gap:4px;min-width:0">
                            <h2 style="font-size:1.05rem">Sektor za≈Çadunkowy</h2>
                            <div style="color:rgba(255,255,255,0.65);font-size:.90rem">
                                Wymagany ‚Ä¢ dok≈Çadnie jeden
                            </div>
                        </div>
                    </header>

                    <div class="card-b">
                        <input type="hidden" th:name="loadingSector.type"
                               th:value="${command.loadingSector != null && command.loadingSector.type != null ? command.loadingSector.type : 'LOADING'}"/>

                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
                            <div>
                                <label class="form-label">Kod</label>
                                <input class="form-input mono"
                                       th:field="*{loadingSector.code}"
                                       placeholder="np. ZAL-01"
                                       required/>
                                <div class="form-err" th:if="${#fields.hasErrors('loadingSector.code')}" th:errors="*{loadingSector.code}"></div>
                            </div>

                            <div>
                                <label class="form-label">Nazwa</label>
                                <input class="form-input"
                                       th:field="*{loadingSector.name}"
                                       placeholder="np. Strefa za≈Çadunku"
                                       required/>
                                <div class="form-err" th:if="${#fields.hasErrors('loadingSector.name')}" th:errors="*{loadingSector.name}"></div>
                            </div>
                        </div>

                        <div class="form-hint" style="margin-top:10px">
                            Kod sektora jest unikalny w ramach magazynu.
                        </div>
                    </div>
                </section>

                <section class="card sector-card sector-card--unloading"
                         style="box-shadow:none;border:1px solid rgba(255,255,255,0.10)">
                    <header class="card-h" style="border-bottom:1px solid rgba(255,255,255,0.08)">
                        <div style="display:flex;flex-direction:column;gap:4px;min-width:0">
                            <h2 style="font-size:1.05rem">Sektor roz≈Çadunkowy</h2>
                            <div style="color:rgba(255,255,255,0.65);font-size:.90rem">
                                Wymagany ‚Ä¢ dok≈Çadnie jeden
                            </div>
                        </div>
                    </header>

                    <div class="card-b">
                        <input type="hidden" th:name="unloadingSector.type"
                               th:value="${command.unloadingSector != null && command.unloadingSector.type != null ? command.unloadingSector.type : 'UNLOADING'}"/>

                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
                            <div>
                                <label class="form-label">Kod</label>
                                <input class="form-input mono"
                                       th:field="*{unloadingSector.code}"
                                       placeholder="np. ROZ-01"
                                       required/>
                                <div class="form-err" th:if="${#fields.hasErrors('unloadingSector.code')}" th:errors="*{unloadingSector.code}"></div>
                            </div>

                            <div>
                                <label class="form-label">Nazwa</label>
                                <input class="form-input"
                                       th:field="*{unloadingSector.name}"
                                       placeholder="np. Strefa roz≈Çadunku"
                                       required/>
                                <div class="form-err" th:if="${#fields.hasErrors('unloadingSector.name')}" th:errors="*{unloadingSector.name}"></div>
                            </div>
                        </div>

                        <div class="form-hint" style="margin-top:10px">
                            To tutaj bƒôdƒÖ trafia≈Çy dostawy do przyjƒôcia/roz≈Çadunku.
                        </div>
                    </div>
                </section>

                <section class="card sector-card sector-card--normal"
                         style="box-shadow:none;border:1px solid rgba(255,255,255,0.10)">
                    <header class="card-h" style="border-bottom:1px solid rgba(255,255,255,0.08)">
                        <div style="display:flex;flex-direction:column;gap:4px;min-width:0">
                            <h2 style="font-size:1.05rem">Sektor zwyk≈Çy</h2>
                            <div style="color:rgba(255,255,255,0.65);font-size:.90rem">
                                Wymagany ‚Ä¢ dok≈Çadnie jeden
                            </div>
                        </div>
                    </header>

                    <div class="card-b">
                        <input type="hidden" th:name="sector.type"
                               th:value="${command.sector != null && command.sector.type != null ? command.sector.type : 'NORMAL'}"/>

                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
                            <div>
                                <label class="form-label">Kod</label>
                                <input class="form-input mono"
                                       th:field="*{sector.code}"
                                       placeholder="np. S-01"
                                       required/>
                                <div class="form-err" th:if="${#fields.hasErrors('sector.code')}" th:errors="*{sector.code}"></div>
                            </div>

                            <div>
                                <label class="form-label">Nazwa</label>
                                <input class="form-input"
                                       th:field="*{sector.name}"
                                       placeholder="np. Sk≈Çadowanie"
                                       required/>
                                <div class="form-err" th:if="${#fields.hasErrors('sector.name')}" th:errors="*{sector.name}"></div>
                            </div>
                        </div>

                        <div class="form-hint" style="margin-top:10px">
                            To ‚Äûdomy≈õlny‚Äù sektor sk≈Çadowania dla magazynu.
                        </div>
                    </div>
                </section>

                <div class="form-actions">
                    <button class="chip chip--save" type="submit">
                        üíæ Utw√≥rz magazyn
                    </button>
                </div>

            </form>
        </div>
    </section>

    <script>
        function toggleWarehouseAddressMode(){
            const chk = document.getElementById('useExistingAddress');
            const pick = document.getElementById('addrPick');
            const nw   = document.getElementById('addrNew');
            const sel  = document.getElementById('addressIdSelect');

            const street  = document.getElementById('addrStreet');
            const zip     = document.getElementById('addrZip');
            const city    = document.getElementById('addrCity');
            const country = document.getElementById('addrCountry');

            const useExisting = !!(chk && chk.checked);

            if (pick) pick.style.display = useExisting ? '' : 'none';
            if (nw)   nw.style.display   = useExisting ? 'none' : '';

            if (sel) sel.required = useExisting;

            if (street)  street.required  = !useExisting;
            if (zip)     zip.required     = !useExisting;
            if (city)    city.required    = !useExisting;
            if (country) country.required = !useExisting;
        }

        (function initWarehouseAddressMode(){
            toggleWarehouseAddressMode();
        })();
    </script>

</div>
